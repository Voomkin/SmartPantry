<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">screens/BarcodeAdd.js | smartpantry</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AboutScreen">AboutScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AccountsScreen">AccountsScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sendEmail">sendEmail</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AddItemScreen">AddItemScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AddShoppingListItemScreen">AddShoppingListItemScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-BarcodeAddScreen">BarcodeAddScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-CreatePantryScreen">CreatePantryScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-CreditsScreen">CreditsScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-HelpScreen">HelpScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-HomeStackScreen">HomeStackScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ManualAddScreen">ManualAddScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-MyInfoScreen">MyInfoScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-NotificationsScreen">NotificationsScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-OtherPantryScreen">OtherPantryScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-PatchNotesScreen">PatchNotesScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ProfileScreen">ProfileScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SettingsStackScreen">SettingsStackScreen</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ShoppingStackScreen">ShoppingStackScreen</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">screens/BarcodeAdd.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React, {useState, useEffect } from &quot;react&quot;;
import { Input, Button } from &quot;react-native-elements&quot;;
import { View, Text, StyleSheet, Alert, Modal} from &quot;react-native&quot;;
import { Auth, API, graphqlOperation } from &quot;aws-amplify&quot;;
import { createItem } from &quot;../mutations&quot;;
import { BarCodeScanner } from &quot;expo-barcode-scanner&quot;;

const BarcodeAddScreen = ({ navigation }) =&gt; {
  const [hasPermission, setHasPermission] = useState(null);
  const [scanned, setScanned] = useState(false);
  const [isModalVisible, setIsModalVisible] = useState(false);

  const handleModal = () =&gt; setIsModalVisible(() =&gt; !isModalVisible);

  const [nameText, setNameText] = useState(&quot;&quot;);
  const [weightText, setWeightText] = useState(&quot;&quot;);
  const [quantityText, setQuantityText] = useState(&quot;&quot;);

  const addPantryItem = async () =&gt; {
    if (nameText == &quot;&quot;) {
      return;
    }

    const user = await Auth.currentAuthenticatedUser();
    const itemInput = {
      name: nameText,
      imagePath: &quot;default_img&quot;,
      weight: parseFloat(weightText),
      currWeight: parseFloat(weightText),
      quantity: parseInt(quantityText),
      pantryItemsId: user.username.toString(),
    };
    const inputItem = await API.graphql(
      graphqlOperation(createItem, { input: itemInput })
    );
    navigation.navigate(&quot;AddItem&quot;);
  };

  useEffect(() =&gt; {
    (async () =&gt; {
      const { status } = await BarCodeScanner.requestPermissionsAsync();
      setHasPermission(status === &quot;granted&quot;);
    })();
  }, []);

  // test api call with edamam
  const fetchApiCall = (upcCode) =&gt; {
    fetch(
      &quot;https://api.edamam.com/api/food-database/v2/parser?app_id=a82b5608&amp;app_key=0024069e0841f1b87a40123aeefab05c&amp;upc=&quot; + `${upcCode}` + &quot;&amp;nutrition-type=cooking&quot;,
      {
        method: &quot;GET&quot;,
        headers: {
          Accept: &quot;application/json&quot;,
        },
      }
    )
      .then((response) =&gt; response.json())
      .then((response) =&gt; {
        try {

          // response.hints[0].food.label -&gt; name of the food item
          // Alert.alert(response.hints[0].food.label);
          setNameText(response.hints[0].food.label);
          handleModal();
        } catch (err) {
          Alert.alert(&apos;Couldn\&apos;t find barcode, please manually add&apos;);
          navigation.navigate(&quot;AddItem&quot;);
        } 
      });
  };

  if (hasPermission === null) {
    return &lt;Text&gt;Requesting for camera permissions&lt;/Text&gt;;
  }

  if (hasPermission === false) {
    return &lt;Text&gt;No access to camera!&lt;/Text&gt;;
  }

  return (
    &lt;View style={{ flex: 1, alignItems: &quot;center&quot;, justifyContent: &quot;center&quot; }}&gt;
      &lt;BarCodeScanner
        onBarCodeScanned={
          scanned
            ? undefined
            : ({ data }) =&gt; {
                setScanned(true);
                fetchApiCall(data);
              }
        }
        style={StyleSheet.absoluteFillObject}
      /&gt;
      &lt;Modal visible={isModalVisible} animationType=&quot;slide&quot;&gt;
        &lt;View style={{ flex: 1, alignItems: &quot;center&quot;, justifyContent: &quot;center&quot; }}&gt;
          &lt;Text style={{width: 250}}&gt;{nameText}&lt;/Text&gt;
          &lt;Input
            placeholder=&quot;Weight (lbs.) (optional)&quot;
            containerStyle={{ width: 250 }}
            onChangeText={(value) =&gt; setWeightText(value)}
          /&gt;
          &lt;Input
            placeholder=&quot;Quantity (optional)&quot;
            containerStyle={{ width: 250 }}
            onChangeText={(value) =&gt; setQuantityText(value)}
          /&gt;
          &lt;Button
            buttonStyle={{ width: 200 }}
            title=&quot;Submit&quot;
            onPress={() =&gt; {
              addPantryItem();
            }}
          &gt;&lt;/Button&gt;
          &lt;Button buttonStyle={{width: 200, margin: 10}} title=&quot;Go Back&quot; onPress={handleModal}&gt;&lt;/Button&gt;
        &lt;/View&gt;
      &lt;/Modal&gt;
      {scanned &amp;&amp; (
        &lt;Button
          title={&quot;Tap to Scan again&quot;}
          onPress={() =&gt; setScanned(false)}
        &gt;&lt;/Button&gt;
      )}
    &lt;/View&gt;
  );
};

export default BarcodeAddScreen;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
